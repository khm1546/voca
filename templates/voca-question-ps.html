<!doctype html> 
<html lang="ko"> 
<head>
    <title>QUESTION/PS</title>
    {% if level == '10' %}
    <link rel="stylesheet" type="text/css" href="/static/css/voca-question-pre.css">
    {% elif level == '5' %}
    <link rel="stylesheet" type="text/css" href="/static/css/voca-question-pre.css">
    {% elif level == '4' %}
    <link rel="stylesheet" type="text/css" href="/static/css/voca-question-junior.css">
    {% elif level == '3' %}
    <link rel="stylesheet" type="text/css" href="/static/css/voca-question-jh.css">
    {% elif level == '6' %}
    <link rel="stylesheet" type="text/css" href="/static/css/voca-question-jh.css">
    {% endif %}
    {% include 'header.html' %}
</head>
<body>
    <div id="wrap">
        <section class="memo">
            <div class="select-unit">SELECT UNIT</div>
            <section class="question-box">
                <section></section>
            </section>
            <section class="answer-box">
                <div class="left-box"></div>
                <div class="center-box"></div>
                <div class="right-box"></div>
            </section>

            <div class="time-box text-center" id="count-down-timer"></div>
            <img src="/static/images/molla.png" class="molla">
        </section>
        <div class="BtnList">
            <img src="/static/images/next-btn.png" class="PlayBtn next-btn">
            <img src="/static/images/pre-btn.png" class="PlayBtn pre-btn">
            <img src="/static/images/setting.png" class="PlayBtn setting">
            <img src="/static/images/cancel.png" class="PlayBtn cancel">
        </div>
    </div>
    <form id="question-form" method="post" action="/result">
        <input type="hidden" name="level" value="{{level}}">
        <input type="hidden" id="q1">
        <input type="hidden" id="q2">
        <input type="hidden" id="q3">
        <input type="hidden" id="q4">
        <input type="hidden" id="q5">
    </form>
</body>
{% include 'header-html.html' %}
<script>
    var qCnt = 1;

    $(document).on('click','.next-btn', function (){
        qCnt ++;
        if(qCnt > 3){
            var qCon = confirm("마지막 문항입니다. 제출하시겠습니까?");
            if(qCon){
                $("#question-form").submit();
            }else{
                qCnt --;
                return false;
            }

        }else{
           $(".question-total").hide();
           $(".q" + qCnt).show();
        }
    });

    $(document).on('click','.pre-btn', function (){
          qCnt --;
        var example = $(this).data("example");

        $("#q" + qCnt).val("");

       if(qCnt == 0){
           alert("첫 번째 문항입니다.");
           qCnt++;
           return false;
       }else{
           $(".question-total").hide();
           $(".q" + qCnt).show();
       }
    });

    $(document).on('click', '.example', function (){
        var example = $(this).data("example");

        $("#q" + qCnt).val(example);
        qCnt ++;
        if(qCnt > 3){
            var qCon = confirm("마지막 문항입니다. 제출하시겠습니까?");
            if(qCon){
                $("#question-form").submit();
            }else{
                qCnt --;
                return false;
            }
        }else{
           $(".question-total").hide();
           $(".q" + qCnt).show();
        }
    });

    function paddedFormat(num) {
        return num < 10 ? "0" + num : num; 
    }

    function startCountDown(duration, element) {

        let secondsRemaining = duration;
        let min = 0;
        let sec = 0;

        let countInterval = setInterval(function () {

            min = parseInt(secondsRemaining / 60);
            sec = parseInt(secondsRemaining % 60);

            element.textContent = `${paddedFormat(min)}:${paddedFormat(sec)}`;

            secondsRemaining = secondsRemaining - 1;
            if($("#count-down-timer").text() == "00:00"){
                alert("시간이 초과되어 시험이 종료되었습니다.");
                location.href='/result';
            }
            if (secondsRemaining < 0) { clearInterval(countInterval) };

        }, 1000);
    }



    window.onload = function () {

        $.ajax({
            url:"/voca/ajax/q_load",
            type:"post"
        }).done(function (result){
            console.log(result);
                var q_html = '';
                var a_html = '';
            for(var i=0; i<result.length; i++){

                if({{level}} == result[i].level && result[i].level == 10){
                    q_html += "<div class='q"+ result[i].question.q_num +" question-total'>" + result[i].question.q + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='A'>" + result[i].question.a1 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='B'>" + result[i].question.a2 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='C'>" + result[i].question.a3 + "</div>";
                }else if({{level}} == result[i].level && result[i].level == 5){
                    q_html += "<div class='q"+ result[i].question.q_num +" question-total'>" + result[i].question.q + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='A'>" + result[i].question.a1 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='B'>" + result[i].question.a2 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='C'>" + result[i].question.a3 + "</div>";
                }else if({{level}} == result[i].level && result[i].level == 4){
                    q_html += "<div class='q"+ result[i].question.q_num +" question-total'>" + result[i].question.q + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='A'>" + result[i].question.a1 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='B'>" + result[i].question.a2 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='C'>" + result[i].question.a3 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='D'>" + result[i].question.a4 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='E'>" + result[i].question.a5 + "</div>";
                }else if({{level}} == result[i].level && result[i].level == 3){
                    q_html += "<div class='q"+ result[i].question.q_num +" question-total'>" + result[i].question.q + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='A'>" + result[i].question.a1 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='B'>" + result[i].question.a2 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='C'>" + result[i].question.a3 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='D'>" + result[i].question.a4 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='E'>" + result[i].question.a5 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='F'>" + result[i].question.a6 + "</div>";
                }else if({{level}} == result[i].level && result[i].level == 6){
                    q_html += "<div class='q"+ result[i].question.q_num +" question-total'>" + result[i].question.q + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='A'>" + result[i].question.a1 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='B'>" + result[i].question.a2 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='C'>" + result[i].question.a3 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example left-box question-total' data-example='D'>" + result[i].question.a4 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example center-box question-total' data-example='E'>" + result[i].question.a5 + "</div>";
                    a_html += "<div class='q"+ result[i].question.q_num +" example right-box question-total' data-example='F'>" + result[i].question.a6 + "</div>";
                }


            }
            $(".question-box").html(q_html);
            $(".answer-box").html(a_html);

            $(".question-total").hide();
            $(".q1").show();
        });

        let time_minutes = 15; // Value in minutes
        let time_seconds = 00; // Value in seconds

        let duration = time_minutes * 60 + time_seconds;

        element = document.querySelector('#count-down-timer');
        element.textContent = `${paddedFormat(time_minutes)}:${paddedFormat(time_seconds)}`;

        startCountDown(--duration, element);

    };



    </script>
</html>